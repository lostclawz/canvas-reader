<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>src/utils/reader-utils.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BookChooser">BookChooser</a></li><li><a href="global.html#CanvasReader">CanvasReader</a></li><li><a href="global.html#HOST">HOST</a></li><li><a href="global.html#LINE_BREAK">LINE_BREAK</a></li><li><a href="global.html#NODE_SERVER_PORT">NODE_SERVER_PORT</a></li><li><a href="global.html#PORT">PORT</a></li><li><a href="global.html#Reader">Reader</a></li><li><a href="global.html#Whether">Whether</a></li><li><a href="global.html#applyScrollDelta">applyScrollDelta</a></li><li><a href="global.html#clamp">clamp</a></li><li><a href="global.html#computeRatio">computeRatio</a></li><li><a href="global.html#ctx">ctx</a></li><li><a href="global.html#draw">draw</a></li><li><a href="global.html#fillStyle">fillStyle</a></li><li><a href="global.html#firstTrue">firstTrue</a></li><li><a href="global.html#getCanvasHeight">getCanvasHeight</a></li><li><a href="global.html#getHeight">getHeight</a></li><li><a href="global.html#getScrollOffset">getScrollOffset</a></li><li><a href="global.html#getTextHeight">getTextHeight</a></li><li><a href="global.html#getWidth">getWidth</a></li><li><a href="global.html#getX">getX</a></li><li><a href="global.html#getY">getY</a></li><li><a href="global.html#handleMouseDown">handleMouseDown</a></li><li><a href="global.html#handleMouseMove">handleMouseMove</a></li><li><a href="global.html#handleMouseUp">handleMouseUp</a></li><li><a href="global.html#height">height</a></li><li><a href="global.html#joinLines">joinLines</a></li><li><a href="global.html#lineHeight">lineHeight</a></li><li><a href="global.html#lineSpacer">lineSpacer</a></li><li><a href="global.html#lines">lines</a></li><li><a href="global.html#linesRaw">linesRaw</a></li><li><a href="global.html#measureFn">measureFn</a></li><li><a href="global.html#measureWordSet">measureWordSet</a></li><li><a href="global.html#memo">memo</a></li><li><a href="global.html#paragraphs">paragraphs</a></li><li><a href="global.html#quickStringSearch">quickStringSearch</a></li><li><a href="global.html#ratio">ratio</a></li><li><a href="global.html#rawContent">rawContent</a></li><li><a href="global.html#rebuildContent">rebuildContent</a></li><li><a href="global.html#reduceLines">reduceLines</a></li><li><a href="global.html#relativeMousePos">relativeMousePos</a></li><li><a href="global.html#resizeCanvas">resizeCanvas</a></li><li><a href="global.html#scrollBar">scrollBar</a></li><li><a href="global.html#searchText">searchText</a></li><li><a href="global.html#searcher">searcher</a></li><li><a href="global.html#setCanvasHeight">setCanvasHeight</a></li><li><a href="global.html#setCanvasWidth">setCanvasWidth</a></li><li><a href="global.html#setScrollOffset">setScrollOffset</a></li><li><a href="global.html#setTextHeight">setTextHeight</a></li><li><a href="global.html#setupScrollBar">setupScrollBar</a></li><li><a href="global.html#size">size</a></li><li><a href="global.html#splitLines">splitLines</a></li><li><a href="global.html#stopMouseEvents">stopMouseEvents</a></li><li><a href="global.html#textCenter">textCenter</a></li><li><a href="global.html#updateCanvas">updateCanvas</a></li><li><a href="global.html#updateFontProps">updateFontProps</a></li><li><a href="global.html#updateSearch">updateSearch</a></li><li><a href="global.html#useResizeObserver">useResizeObserver</a></li><li><a href="global.html#width">width</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">src/utils/reader-utils.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Text processing utilities for the canvas reader.
 * Provides functions for text measurement, line breaking, search, and formatting.
 * Many functions are functional wrappers around Ramda operations for consistency.
 */

import * as R from 'ramda';
import { LINE_BREAK } from '../constants/constants.js';

/**
 * Memoization wrapper using identity function as cache key.
 * Caches function results based on the first argument's identity.
 * @type {Function}
 * @example
 * const expensiveFn = memo((x) => x * x);
 * expensiveFn(5); // Computed
 * expensiveFn(5); // Cached
 */
export const memo = R.memoizeWith(R.identity);

/**
 * Inserts LINE_BREAK characters between array elements.
 * @type {Function}
 * @example
 * lineSpacer(['a', 'b', 'c']); // ['a', '\n', 'b', '\n', 'c']
 */
export const lineSpacer = R.intersperse(LINE_BREAK);

/**
 * Splits text on LINE_BREAK characters into an array of lines.
 * @type {Function}
 * @example
 * splitLines('line1\nline2\nline3'); // ['line1', 'line2', 'line3']
 */
export const splitLines = R.split(LINE_BREAK);

/**
 * Joins an array of lines with LINE_BREAK characters.
 * @type {Function}
 * @example
 * joinLines(['line1', 'line2']); // 'line1\nline2'
 */
export const joinLines = R.join(LINE_BREAK);

/**
 * Creates a function that measures the width of an array of words when joined with spaces.
 * Uses the canvas measureText API to get pixel width.
 *
 * @param {CanvasRenderingContext2D} context - Canvas 2D rendering context for text measurement
 * @returns {Function} A function that takes an array of words and returns total width in pixels
 *
 * @example
 * const ctx = canvas.getContext('2d');
 * ctx.font = '16px Arial';
 * const measure = measureWordSet(ctx);
 * const width = measure(['Hello', 'World']); // Returns pixel width of "Hello World"
 */
export const measureWordSet = (context) =>
  R.pipe(R.join(' '), (txt) => context.measureText(txt), R.prop('width'));

/**
 * Breaks text into lines that fit within a maximum width.
 * Preserves original line breaks and wraps long lines to fit the width constraint.
 * Uses a greedy algorithm to pack as many words as possible on each line.
 *
 * @param {Function} measureFn - Function that takes an array of words and returns pixel width
 * @param {number} maxWidth - Maximum allowed width for each line in pixels
 * @param {string} text - Input text to be broken into lines
 * @returns {string[]} Array of lines, each fitting within maxWidth
 *
 * @example
 * const measure = (words) => words.join(' ').length * 10; // Simplified measurement
 * const lines = reduceLines(measure, 100, 'This is a long sentence that needs wrapping');
 * // Returns: ['This is a', 'long', 'sentence', 'that needs', 'wrapping']
 */
export const reduceLines = (measureFn, maxWidth, text) =>
  R.pipe(
    R.split('\n'),
    R.map(R.pipe(R.split(' '), R.map(R.trim))),
    R.chain(
      R.reduce(
        (lines, word) =>
          R.pipe(
            R.last,
            R.append(word),
            measureFn,
            R.ifElse(
              R.gt(R.__, maxWidth),
              () => lines.concat([[word]]),
              () => R.adjust(-1, R.append(word), lines),
            ),
          )(lines),
        [[]],
      ),
    ),
    R.map(R.join(' ')),
  )(text);

/**
 * Search result object.
 * @typedef {Object} SearchResult
 * @property {string} searchText - The search term that was used
 * @property {Array&lt;string>} results - Matching lines interspersed with LINE_BREAK
 * @property {number} total - Total number of matches found
 */

/**
 * Creates a case-insensitive search function for an array of strings.
 * Returns a curried function that performs the search when given a query.
 *
 * @param {string[]} list - Array of strings to search within
 * @returns {Function} Search function that takes a search term and returns results
 *
 * @example
 * const lines = ['Hello World', 'Goodbye World', 'Test Line'];
 * const search = quickStringSearch(lines);
 *
 * const results = search('world');
 * // Returns: {
 * //   searchText: 'world',
 * //   results: ['Hello World', '\n', 'Goodbye World'],
 * //   total: 2
 * // }
 *
 * search(''); // Returns original list (no search)
 */
export const quickStringSearch = (list) => (searchFor = '') => {
  let i;
  const results = [];
  let total = 0;
  if (!searchFor) {
    return list;
  }
  const s = searchFor.toLowerCase();
  for (i = 0; i &lt; list.length; i++) {
    if (list[i].toLowerCase().indexOf(s) >= 0) {
      total++;
      results.push(list[i]);
    }
  }
  return {
    searchText: searchFor,
    results: lineSpacer(results),
    total,
  };
};

/**
 * Stops event propagation and prevents default behavior.
 * Useful for preventing unwanted event bubbling and browser defaults.
 *
 * @param {Event} e - DOM event to stop
 *
 * @example
 * element.addEventListener('click', stopMouseEvents);
 * // Equivalent to:
 * element.addEventListener('click', (e) => {
 *   e.stopPropagation();
 *   e.preventDefault();
 * });
 */
export const stopMouseEvents = (e) => {
  e.stopPropagation();
  e.preventDefault();
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
