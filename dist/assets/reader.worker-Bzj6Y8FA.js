(function(){"use strict";const d={INIT:"INIT",KILL:"KILL",SCROLL:"SCROLL",UPDATE:"UPDATE",SEARCH:"SEARCH",MOUSE_DOWN:"MOUSE_DOWN",MOUSE_UP:"MOUSE_UP",MOUSE_MOVE:"MOUSE_MOVE"};var Et={"@@functional/placeholder":!0};function l(e){return e!=null&&typeof e=="object"&&e["@@functional/placeholder"]===!0}function p(e){return function t(r){return arguments.length===0||l(r)?t:e.apply(this,arguments)}}function f(e){return function t(r,n){switch(arguments.length){case 0:return t;case 1:return l(r)?t:p(function(a){return e(r,a)});default:return l(r)&&l(n)?t:l(r)?p(function(a){return e(a,n)}):l(n)?p(function(a){return e(r,a)}):e(r,n)}}}function Q(e,t){e=e||[],t=t||[];var r,n=e.length,a=t.length,u=[];for(r=0;r<n;)u[u.length]=e[r],r+=1;for(r=0;r<a;)u[u.length]=t[r],r+=1;return u}function E(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(r){return t.apply(this,arguments)};case 2:return function(r,n){return t.apply(this,arguments)};case 3:return function(r,n,a){return t.apply(this,arguments)};case 4:return function(r,n,a,u){return t.apply(this,arguments)};case 5:return function(r,n,a,u,o){return t.apply(this,arguments)};case 6:return function(r,n,a,u,o,c){return t.apply(this,arguments)};case 7:return function(r,n,a,u,o,c,i){return t.apply(this,arguments)};case 8:return function(r,n,a,u,o,c,i,y){return t.apply(this,arguments)};case 9:return function(r,n,a,u,o,c,i,y,k){return t.apply(this,arguments)};case 10:return function(r,n,a,u,o,c,i,y,k,R){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function tt(e,t,r){return function(){for(var n=[],a=0,u=e,o=0;o<t.length||a<arguments.length;){var c;o<t.length&&(!l(t[o])||a>=arguments.length)?c=t[o]:(c=arguments[a],a+=1),n[o]=c,l(c)||(u-=1),o+=1}return u<=0?r.apply(this,n):E(u,tt(e,n,r))}}var L=f(function(t,r){return t===1?p(r):E(t,tt(t,[],r))});function C(e){return function t(r,n,a){switch(arguments.length){case 0:return t;case 1:return l(r)?t:f(function(u,o){return e(r,u,o)});case 2:return l(r)&&l(n)?t:l(r)?f(function(u,o){return e(u,n,o)}):l(n)?f(function(u,o){return e(r,u,o)}):p(function(u){return e(r,n,u)});default:return l(r)&&l(n)&&l(a)?t:l(r)&&l(n)?f(function(u,o){return e(u,o,a)}):l(r)&&l(a)?f(function(u,o){return e(u,n,o)}):l(n)&&l(a)?f(function(u,o){return e(r,u,o)}):l(r)?p(function(u){return e(u,n,a)}):l(n)?p(function(u){return e(r,u,a)}):l(a)?p(function(u){return e(r,n,u)}):e(r,n,a)}}}var jt=C(function(t,r,n){var a=n.length;if(t>=a||t<-a)return n;var u=(a+t)%a,o=Q(n);return o[u]=r(n[u]),o}),q=Array.isArray||function(t){return t!=null&&t.length>=0&&Object.prototype.toString.call(t)==="[object Array]"};function bt(e){return e!=null&&typeof e["@@transducer/step"]=="function"}function F(e,t,r){return function(){if(arguments.length===0)return r();var n=arguments[arguments.length-1];if(!q(n)){for(var a=0;a<e.length;){if(typeof n[e[a]]=="function")return n[e[a]].apply(n,Array.prototype.slice.call(arguments,0,-1));a+=1}if(bt(n)){var u=t.apply(null,Array.prototype.slice.call(arguments,0,-1));return u(n)}}return r.apply(this,arguments)}}var S={init:function(){return this.xf["@@transducer/init"]()},result:function(e){return this.xf["@@transducer/result"](e)}};function N(e,t){for(var r=0,n=t.length,a=Array(n);r<n;)a[r]=e(t[r]),r+=1;return a}function et(e){return Object.prototype.toString.call(e)==="[object String]"}var D=p(function(t){return q(t)?!0:!t||typeof t!="object"||et(t)?!1:t.length===0?!0:t.length>0?t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1):!1}),xt=(function(){function e(t){this.f=t}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(t){return t},e.prototype["@@transducer/step"]=function(t,r){return this.f(t,r)},e})();function It(e){return new xt(e)}var Mt=f(function(t,r){return E(t.length,function(){return t.apply(r,arguments)})});function Ct(e,t,r){for(var n=0,a=r.length;n<a;){if(t=e["@@transducer/step"](t,r[n]),t&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}n+=1}return e["@@transducer/result"](t)}function rt(e,t,r){for(var n=r.next();!n.done;){if(t=e["@@transducer/step"](t,n.value),t&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}n=r.next()}return e["@@transducer/result"](t)}function nt(e,t,r,n){return e["@@transducer/result"](r[n](Mt(e["@@transducer/step"],e),t))}var at=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function j(e,t,r){if(typeof e=="function"&&(e=It(e)),D(r))return Ct(e,t,r);if(typeof r["fantasy-land/reduce"]=="function")return nt(e,t,r,"fantasy-land/reduce");if(r[at]!=null)return rt(e,t,r[at]());if(typeof r.next=="function")return rt(e,t,r);if(typeof r.reduce=="function")return nt(e,t,r,"reduce");throw new TypeError("reduce: list must be array or iterable")}var Nt=(function(){function e(t,r){this.xf=r,this.f=t}return e.prototype["@@transducer/init"]=S.init,e.prototype["@@transducer/result"]=S.result,e.prototype["@@transducer/step"]=function(t,r){return this.xf["@@transducer/step"](t,this.f(r))},e})(),Ut=f(function(t,r){return new Nt(t,r)});function b(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var ut=Object.prototype.toString,Tt=(function(){return ut.call(arguments)==="[object Arguments]"?function(t){return ut.call(t)==="[object Arguments]"}:function(t){return b("callee",t)}})(),kt=!{toString:null}.propertyIsEnumerable("toString"),it=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],ot=(function(){return arguments.propertyIsEnumerable("length")})(),Rt=function(t,r){for(var n=0;n<t.length;){if(t[n]===r)return!0;n+=1}return!1},_=p(typeof Object.keys=="function"&&!ot?function(t){return Object(t)!==t?[]:Object.keys(t)}:function(t){if(Object(t)!==t)return[];var r,n,a=[],u=ot&&Tt(t);for(r in t)b(r,t)&&(!u||r!=="length")&&(a[a.length]=r);if(kt)for(n=it.length-1;n>=0;)r=it[n],b(r,t)&&!Rt(a,r)&&(a[a.length]=r),n-=1;return a}),x=f(F(["fantasy-land/map","map"],Ut,function(t,r){switch(Object.prototype.toString.call(r)){case"[object Function]":return L(r.length,function(){return t.call(this,r.apply(this,arguments))});case"[object Object]":return j(function(n,a){return n[a]=t(r[a]),n},{},_(r));default:return N(t,r)}})),Ht=Number.isInteger||function(t){return t<<0===t},ct=f(function(t,r){var n=t<0?r.length+t:t;return et(r)?r.charAt(n):r[n]}),Lt=f(function(t,r){if(r!=null)return Ht(t)?ct(t,r):r[t]}),st=C(j),lt=f(function(t,r){return Q(r,[t])});function qt(e){var t=Object.prototype.toString.call(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object AsyncGeneratorFunction]"}function Ft(e){return function(r){for(var n,a,u,o=[],c=0,i=r.length;c<i;){if(D(r[c]))for(n=r[c],u=0,a=n.length;u<a;)o[o.length]=n[u],u+=1;else o[o.length]=r[c];c+=1}return o}}function Dt(e){return{"@@transducer/value":e,"@@transducer/reduced":!0}}var Pt=function(e){return{"@@transducer/init":S.init,"@@transducer/result":function(t){return e["@@transducer/result"](t)},"@@transducer/step":function(t,r){var n=e["@@transducer/step"](t,r);return n["@@transducer/reduced"]?Dt(n):n}}},Wt=function(t){var r=Pt(t);return{"@@transducer/init":S.init,"@@transducer/result":function(n){return r["@@transducer/result"](n)},"@@transducer/step":function(n,a){return D(a)?j(r,n,a):j(r,n,[a])}}},Bt=f(function(t,r){return x(t,Wt(r))}),zt=f(F(["fantasy-land/chain","chain"],Bt,function(t,r){return typeof r=="function"?function(n){return t(r(n))(n)}:Ft()(x(t,r))})),ft=p(function(t){return t===null?"Null":t===void 0?"Undefined":Object.prototype.toString.call(t).slice(8,-1)});function Xt(e,t){return function(){return t.call(this,e.apply(this,arguments))}}function P(e,t){return function(){var r=arguments.length;if(r===0)return t();var n=arguments[r-1];return q(n)||typeof n[e]!="function"?t.apply(this,arguments):n[e].apply(n,Array.prototype.slice.call(arguments,0,r-1))}}var Kt=C(P("slice",function(t,r,n){return Array.prototype.slice.call(n,t,r)})),$t=p(P("tail",Kt(1,1/0)));function U(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return E(arguments[0].length,st(Xt,arguments[0],$t(arguments)))}function Gt(e){return e}var Vt=p(Gt);function gt(e){for(var t=[],r;!(r=e.next()).done;)t.push(r.value);return t}function pt(e,t,r){for(var n=0,a=r.length;n<a;){if(e(t,r[n]))return!0;n+=1}return!1}function Yt(e){var t=String(e).match(/^function (\w*)/);return t==null?"":t[1]}function Zt(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}var W=typeof Object.is=="function"?Object.is:Zt;function ht(e,t,r,n){var a=gt(e),u=gt(t);function o(c,i){return B(c,i,r.slice(),n.slice())}return!pt(function(c,i){return!pt(o,i,c)},u,a)}function B(e,t,r,n){if(W(e,t))return!0;var a=ft(e);if(a!==ft(t))return!1;if(typeof e["fantasy-land/equals"]=="function"||typeof t["fantasy-land/equals"]=="function")return typeof e["fantasy-land/equals"]=="function"&&e["fantasy-land/equals"](t)&&typeof t["fantasy-land/equals"]=="function"&&t["fantasy-land/equals"](e);if(typeof e.equals=="function"||typeof t.equals=="function")return typeof e.equals=="function"&&e.equals(t)&&typeof t.equals=="function"&&t.equals(e);switch(a){case"Arguments":case"Array":case"Object":if(typeof e.constructor=="function"&&Yt(e.constructor)==="Promise")return e===t;break;case"Boolean":case"Number":case"String":if(!(typeof e==typeof t&&W(e.valueOf(),t.valueOf())))return!1;break;case"Date":if(!W(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(!(e.source===t.source&&e.global===t.global&&e.ignoreCase===t.ignoreCase&&e.multiline===t.multiline&&e.sticky===t.sticky&&e.unicode===t.unicode))return!1;break}for(var u=r.length-1;u>=0;){if(r[u]===e)return n[u]===t;u-=1}switch(a){case"Map":return e.size!==t.size?!1:ht(e.entries(),t.entries(),r.concat([e]),n.concat([t]));case"Set":return e.size!==t.size?!1:ht(e.values(),t.values(),r.concat([e]),n.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var o=_(e);if(o.length!==_(t).length)return!1;var c=r.concat([e]),i=n.concat([t]);for(u=o.length-1;u>=0;){var y=o[u];if(!(b(y,t)&&B(t[y],e[y],c,i)))return!1;u-=1}return!0}var Jt=f(function(t,r){return B(t,r,[],[])});function Qt(e,t,r){var n,a;if(typeof e.indexOf=="function")switch(typeof t){case"number":if(t===0){for(n=1/t;r<e.length;){if(a=e[r],a===0&&1/a===n)return r;r+=1}return-1}else if(t!==t){for(;r<e.length;){if(a=e[r],typeof a=="number"&&a!==a)return r;r+=1}return-1}return e.indexOf(t,r);case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,r);case"object":if(t===null)return e.indexOf(t,r)}for(;r<e.length;){if(Jt(e[r],t))return r;r+=1}return-1}function te(e,t){return Qt(t,e,0)>=0}function z(e){var t=e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+t.replace(/"/g,'\\"')+'"'}var I=function(t){return(t<10?"0":"")+t},ee=typeof Date.prototype.toISOString=="function"?function(t){return t.toISOString()}:function(t){return t.getUTCFullYear()+"-"+I(t.getUTCMonth()+1)+"-"+I(t.getUTCDate())+"T"+I(t.getUTCHours())+":"+I(t.getUTCMinutes())+":"+I(t.getUTCSeconds())+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};function re(e){return function(){return!e.apply(this,arguments)}}function ne(e,t){for(var r=0,n=t.length,a=[];r<n;)e(t[r])&&(a[a.length]=t[r]),r+=1;return a}function ae(e){return Object.prototype.toString.call(e)==="[object Object]"}var ue=(function(){function e(t,r){this.xf=r,this.f=t}return e.prototype["@@transducer/init"]=S.init,e.prototype["@@transducer/result"]=S.result,e.prototype["@@transducer/step"]=function(t,r){return this.f(r)?this.xf["@@transducer/step"](t,r):t},e})(),ie=f(function(t,r){return new ue(t,r)}),oe=f(F(["fantasy-land/filter","filter"],ie,function(e,t){return ae(t)?j(function(r,n){return e(t[n])&&(r[n]=t[n]),r},{},_(t)):ne(e,t)})),ce=f(function(t,r){return oe(re(t),r)});function yt(e,t){var r=function(o){var c=t.concat([e]);return te(o,c)?"<Circular>":yt(o,c)},n=function(u,o){return N(function(c){return z(c)+": "+r(u[c])},o.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+N(r,e).join(", ")+"))";case"[object Array]":return"["+N(r,e).concat(n(e,ce(function(u){return/^\d+$/.test(u)},_(e)))).join(", ")+"]";case"[object Boolean]":return typeof e=="object"?"new Boolean("+r(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?r(NaN):z(ee(e)))+")";case"[object Null]":return"null";case"[object Number]":return typeof e=="object"?"new Number("+r(e.valueOf())+")":1/e===-1/0?"-0":e.toString(10);case"[object String]":return typeof e=="object"?"new String("+r(e.valueOf())+")":z(e);case"[object Undefined]":return"undefined";default:if(typeof e.toString=="function"){var a=e.toString();if(a!=="[object Object]")return a}return"{"+n(e,_(e)).join(", ")+"}"}}var se=p(function(t){return yt(t,[])}),le=ct(-1),fe=f(function(t,r){return t>r}),ge=C(function(t,r,n){return L(Math.max(t.length,r.length,n.length),function(){return t.apply(this,arguments)?r.apply(this,arguments):n.apply(this,arguments)})}),pe=f(P("intersperse",function(t,r){for(var n=[],a=0,u=r.length;a<u;)a===u-1?n.push(r[a]):n.push(r[a],t),a+=1;return n})),dt=f(function(t,r){return L(t+1,function(){var n=arguments[t];if(n!=null&&qt(n[r]))return n[r].apply(n,Array.prototype.slice.call(arguments,0,t));throw new TypeError(se(n)+' does not have a method named "'+r+'"')})}),X=dt(1,"join"),he=f(function(t,r){var n={};return E(r.length,function(){var a=t.apply(this,arguments);return b(a,n)||(n[a]=r.apply(this,arguments)),n[a]})}),K=dt(1,"split"),M=`	
\v\f\r                　\u2028\u2029\uFEFF`,ye="​",de=typeof String.prototype.trim=="function",ve=p(!de||M.trim()||!ye.trim()?function(t){var r=new RegExp("^["+M+"]["+M+"]*"),n=new RegExp("["+M+"]["+M+"]*$");return t.replace(r,"").replace(n,"")}:function(t){return t.trim()});const me=he(Vt);pe(`
`),K(`
`),X(`
`);const Se=e=>U(X(" "),t=>e.measureText(t),Lt("width")),_e=(e,t,r)=>U(K(`
`),x(U(K(" "),x(ve))),zt(st((a,u)=>U(le,lt(u),e,ge(fe(Et,t),()=>a.concat([[u]]),()=>jt(-1,lt(u),a)))(a),[[]])),x(X(" ")))(r).map((a,u)=>({text:a,lineNum:u+1})),Oe=e=>(t="")=>{let r;const n=[];let a=0;if(!t)return e;const u=t.toLowerCase(),o=new Set;for(r=0;r<e.length;r++)e[r].text.toLowerCase().indexOf(u)>=0&&(a++,r>0&&o.add(r-1),o.add(r),r<e.length-1&&o.add(r+1));const c=Array.from(o).sort((i,y)=>i-y);for(r=0;r<c.length;r++)n.push(e[c[r]]);return{searchText:t,results:n,total:a}},we=(e,t)=>r=>Math.max(e,Math.min(t,r)),Ae=({ctx:e,width:t=10,height:r=100,canvasWidth:n,canvasHeight:a,scrollOffset:u=0,updateCanvas:o,color:c="black"})=>{const i={x:0,y:0,width:t,height:r,dragging:!1,textHeight:0,canvasWidth:n,canvasHeight:a,scrollOffset:u},y=(g,A)=>g>=i.x&&g<=i.x+i.width&&A>=i.y&&A<=i.y+i.height;let k,R;const H=()=>{R=Math.min(-i.textHeight+i.canvasHeight-100,0),k=we(R,0)};return H(),{draw(){const g=i.scrollOffset/R;i.y=(i.canvasHeight-i.height)*g,i.x=n-i.width,e.fillStyle=c,e.fillRect(i.x,i.y,i.width,i.height)},setTextHeight(g){i.textHeight=g,H()},setCanvasHeight(g){i.canvasHeight=g,H()},setCanvasWidth(g){i.canvasWidth=g,H()},resizeCanvas(g,A){i.canvasWidth=g,i.canvasHeight=A},applyScrollDelta(g){this.setScrollOffset(k(i.scrollOffset-g))},setScrollOffset(g){i.scrollOffset=g,o()},handleMouseDown(g){y(g.x,g.y)&&(i.dragging=!0)},handleMouseUp(g){i.dragging&&(i.dragging=!1)},handleMouseMove(g){if(i.dragging&&g.buttons){const A=i.canvasHeight-i.height,je=(i.textHeight-i.canvasHeight)/A;this.applyScrollDelta(g.movementY*je)}},getScrollOffset:()=>i.scrollOffset,getX:()=>i.x,getY:()=>i.y,getWidth:()=>i.width,getHeight:()=>i.height,getTextHeight:()=>i.textHeight,getCanvasHeight:()=>i.canvasHeight}};let s,v,m,$,G="",V,vt,O=1.1,mt,w=15,St,T=[],Y=[],h;const _t=60,Z=10,Ot=e=>{if(G=e,G&&V){const{results:t}=V(G);T=t}else T=Y;h&&(h.setTextHeight(w*O*T.length),h.setScrollOffset(0))},J=()=>{if(!s)return;s.clearRect(0,0,v,m);let e,t,r;const n=h.getScrollOffset(),a=Math.floor(-n/w/O),u=Math.ceil(m/(O*w))+a,o=v-Z-5,c=v-_t-Z-5;for(t=a;t<=u&&(e=T[t],e!==void 0);t++){if(r=t*O*w+n,r>=-(O*w)&&r<m){const i=typeof e=="string"?e:e.text;s.fillText(i,0,r,c),e.lineNum!==void 0&&(s.save(),s.textAlign="right",s.fillStyle="#888",s.fillText(e.lineNum.toString(),o,r),s.restore())}if(r>m)break}h.draw()},wt=e=>{const{font:t,baseline:r,align:n,strokeStyle:a}=e;O=e.lineHeight,w=e.size,mt=e.fillStyle,s&&(s.font=t,s.textBaseline=r,s.textAlign=n,s.fillStyle=mt,s.strokeStyle=a)},At=e=>{s&&(s.save(),s.clearRect(0,0,v,m),s.font="15px Helvetica",s.textAlign="center",s.textBaseline="middle",s.fillStyle="black",s.fillText(e,v/2,m/2),s.restore())},Ee=()=>{Y=_e(vt,v-_t-Z-5,St),V=me(Oe(Y))};self.onmessage=e=>{switch(e.data.type){case d.INIT:{const{route:t,canvas:r}=e.data;v=e.data.width,m=e.data.height,s=r.getContext("2d"),vt=Se(s),h=Ae({ctx:s,canvasWidth:v,canvasHeight:m,updateCanvas:J}),wt(e.data),$=e.data.ratio,s.setTransform($,0,0,$,0,0),At(`Loading ${t}`),fetch(t).then(n=>n.text()).then(n=>{console.log(n),At(`Content Loaded (${n.length}), parsing...`),St=n,requestAnimationFrame(()=>{Ee(),Ot(""),h.setScrollOffset(0)})}).catch(n=>{console.log(n)});break}case d.KILL:break;case d.SCROLL:{const{scrollDelta:t}=e.data;h.applyScrollDelta(t);break}case d.UPDATE:{wt(e.data),J();break}case d.SEARCH:{Ot(e.data.searchText),J();break}case d.MOUSE_DOWN:h.handleMouseDown(e.data);break;case d.MOUSE_UP:h.handleMouseUp(e.data);break;case d.MOUSE_MOVE:h&&h.handleMouseMove(e.data);break;default:console.log("?",e)}}})();
