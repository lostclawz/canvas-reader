(function(){"use strict";const v={INIT:"INIT",KILL:"KILL",SCROLL:"SCROLL",UPDATE:"UPDATE",SEARCH:"SEARCH",MOUSE_DOWN:"MOUSE_DOWN",MOUSE_UP:"MOUSE_UP",MOUSE_MOVE:"MOUSE_MOVE"};var bt={"@@functional/placeholder":!0};function l(e){return e!=null&&typeof e=="object"&&e["@@functional/placeholder"]===!0}function h(e){return function t(r){return arguments.length===0||l(r)?t:e.apply(this,arguments)}}function f(e){return function t(r,n){switch(arguments.length){case 0:return t;case 1:return l(r)?t:h(function(a){return e(r,a)});default:return l(r)&&l(n)?t:l(r)?h(function(a){return e(a,n)}):l(n)?h(function(a){return e(r,a)}):e(r,n)}}}function tt(e,t){e=e||[],t=t||[];var r,n=e.length,a=t.length,u=[];for(r=0;r<n;)u[u.length]=e[r],r+=1;for(r=0;r<a;)u[u.length]=t[r],r+=1;return u}function x(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(r){return t.apply(this,arguments)};case 2:return function(r,n){return t.apply(this,arguments)};case 3:return function(r,n,a){return t.apply(this,arguments)};case 4:return function(r,n,a,u){return t.apply(this,arguments)};case 5:return function(r,n,a,u,o){return t.apply(this,arguments)};case 6:return function(r,n,a,u,o,c){return t.apply(this,arguments)};case 7:return function(r,n,a,u,o,c,i){return t.apply(this,arguments)};case 8:return function(r,n,a,u,o,c,i,p){return t.apply(this,arguments)};case 9:return function(r,n,a,u,o,c,i,p,y){return t.apply(this,arguments)};case 10:return function(r,n,a,u,o,c,i,p,y,O){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function et(e,t,r){return function(){for(var n=[],a=0,u=e,o=0;o<t.length||a<arguments.length;){var c;o<t.length&&(!l(t[o])||a>=arguments.length)?c=t[o]:(c=arguments[a],a+=1),n[o]=c,l(c)||(u-=1),o+=1}return u<=0?r.apply(this,n):x(u,et(e,n,r))}}var q=f(function(t,r){return t===1?h(r):x(t,et(t,[],r))});function U(e){return function t(r,n,a){switch(arguments.length){case 0:return t;case 1:return l(r)?t:f(function(u,o){return e(r,u,o)});case 2:return l(r)&&l(n)?t:l(r)?f(function(u,o){return e(u,n,o)}):l(n)?f(function(u,o){return e(r,u,o)}):h(function(u){return e(r,n,u)});default:return l(r)&&l(n)&&l(a)?t:l(r)&&l(n)?f(function(u,o){return e(u,o,a)}):l(r)&&l(a)?f(function(u,o){return e(u,n,o)}):l(n)&&l(a)?f(function(u,o){return e(r,u,o)}):l(r)?h(function(u){return e(u,n,a)}):l(n)?h(function(u){return e(r,u,a)}):l(a)?h(function(u){return e(r,n,u)}):e(r,n,a)}}}var Et=U(function(t,r,n){var a=n.length;if(t>=a||t<-a)return n;var u=(a+t)%a,o=tt(n);return o[u]=r(n[u]),o}),F=Array.isArray||function(t){return t!=null&&t.length>=0&&Object.prototype.toString.call(t)==="[object Array]"};function jt(e){return e!=null&&typeof e["@@transducer/step"]=="function"}function W(e,t,r){return function(){if(arguments.length===0)return r();var n=arguments[arguments.length-1];if(!F(n)){for(var a=0;a<e.length;){if(typeof n[e[a]]=="function")return n[e[a]].apply(n,Array.prototype.slice.call(arguments,0,-1));a+=1}if(jt(n)){var u=t.apply(null,Array.prototype.slice.call(arguments,0,-1));return u(n)}}return r.apply(this,arguments)}}var A={init:function(){return this.xf["@@transducer/init"]()},result:function(e){return this.xf["@@transducer/result"](e)}};function k(e,t){for(var r=0,n=t.length,a=Array(n);r<n;)a[r]=e(t[r]),r+=1;return a}function rt(e){return Object.prototype.toString.call(e)==="[object String]"}var D=h(function(t){return F(t)?!0:!t||typeof t!="object"||rt(t)?!1:t.length===0?!0:t.length>0?t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1):!1}),xt=(function(){function e(t){this.f=t}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(t){return t},e.prototype["@@transducer/step"]=function(t,r){return this.f(t,r)},e})();function It(e){return new xt(e)}var Tt=f(function(t,r){return x(t.length,function(){return t.apply(r,arguments)})});function Mt(e,t,r){for(var n=0,a=r.length;n<a;){if(t=e["@@transducer/step"](t,r[n]),t&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}n+=1}return e["@@transducer/result"](t)}function nt(e,t,r){for(var n=r.next();!n.done;){if(t=e["@@transducer/step"](t,n.value),t&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}n=r.next()}return e["@@transducer/result"](t)}function at(e,t,r,n){return e["@@transducer/result"](r[n](Tt(e["@@transducer/step"],e),t))}var ut=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function I(e,t,r){if(typeof e=="function"&&(e=It(e)),D(r))return Mt(e,t,r);if(typeof r["fantasy-land/reduce"]=="function")return at(e,t,r,"fantasy-land/reduce");if(r[ut]!=null)return nt(e,t,r[ut]());if(typeof r.next=="function")return nt(e,t,r);if(typeof r.reduce=="function")return at(e,t,r,"reduce");throw new TypeError("reduce: list must be array or iterable")}var Ct=(function(){function e(t,r){this.xf=r,this.f=t}return e.prototype["@@transducer/init"]=A.init,e.prototype["@@transducer/result"]=A.result,e.prototype["@@transducer/step"]=function(t,r){return this.xf["@@transducer/step"](t,this.f(r))},e})(),Nt=f(function(t,r){return new Ct(t,r)});function T(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var it=Object.prototype.toString,Ut=(function(){return it.call(arguments)==="[object Arguments]"?function(t){return it.call(t)==="[object Arguments]"}:function(t){return T("callee",t)}})(),kt=!{toString:null}.propertyIsEnumerable("toString"),ot=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],ct=(function(){return arguments.propertyIsEnumerable("length")})(),Lt=function(t,r){for(var n=0;n<t.length;){if(t[n]===r)return!0;n+=1}return!1},b=h(typeof Object.keys=="function"&&!ct?function(t){return Object(t)!==t?[]:Object.keys(t)}:function(t){if(Object(t)!==t)return[];var r,n,a=[],u=ct&&Ut(t);for(r in t)T(r,t)&&(!u||r!=="length")&&(a[a.length]=r);if(kt)for(n=ot.length-1;n>=0;)r=ot[n],T(r,t)&&!Lt(a,r)&&(a[a.length]=r),n-=1;return a}),M=f(W(["fantasy-land/map","map"],Nt,function(t,r){switch(Object.prototype.toString.call(r)){case"[object Function]":return q(r.length,function(){return t.call(this,r.apply(this,arguments))});case"[object Object]":return I(function(n,a){return n[a]=t(r[a]),n},{},b(r));default:return k(t,r)}})),Rt=Number.isInteger||function(t){return t<<0===t},st=f(function(t,r){var n=t<0?r.length+t:t;return rt(r)?r.charAt(n):r[n]}),Ht=f(function(t,r){if(r!=null)return Rt(t)?st(t,r):r[t]}),lt=U(I),ft=f(function(t,r){return tt(r,[t])});function qt(e){var t=Object.prototype.toString.call(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object AsyncGeneratorFunction]"}function Ft(e){return function(r){for(var n,a,u,o=[],c=0,i=r.length;c<i;){if(D(r[c]))for(n=r[c],u=0,a=n.length;u<a;)o[o.length]=n[u],u+=1;else o[o.length]=r[c];c+=1}return o}}function Wt(e){return{"@@transducer/value":e,"@@transducer/reduced":!0}}var Dt=function(e){return{"@@transducer/init":A.init,"@@transducer/result":function(t){return e["@@transducer/result"](t)},"@@transducer/step":function(t,r){var n=e["@@transducer/step"](t,r);return n["@@transducer/reduced"]?Wt(n):n}}},Pt=function(t){var r=Dt(t);return{"@@transducer/init":A.init,"@@transducer/result":function(n){return r["@@transducer/result"](n)},"@@transducer/step":function(n,a){return D(a)?I(r,n,a):I(r,n,[a])}}},Bt=f(function(t,r){return M(t,Pt(r))}),zt=f(W(["fantasy-land/chain","chain"],Bt,function(t,r){return typeof r=="function"?function(n){return t(r(n))(n)}:Ft()(M(t,r))})),gt=h(function(t){return t===null?"Null":t===void 0?"Undefined":Object.prototype.toString.call(t).slice(8,-1)});function Xt(e,t){return function(){return t.call(this,e.apply(this,arguments))}}function P(e,t){return function(){var r=arguments.length;if(r===0)return t();var n=arguments[r-1];return F(n)||typeof n[e]!="function"?t.apply(this,arguments):n[e].apply(n,Array.prototype.slice.call(arguments,0,r-1))}}var Kt=U(P("slice",function(t,r,n){return Array.prototype.slice.call(n,t,r)})),$t=h(P("tail",Kt(1,1/0)));function L(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return x(arguments[0].length,lt(Xt,arguments[0],$t(arguments)))}function Gt(e){return e}var Vt=h(Gt);function pt(e){for(var t=[],r;!(r=e.next()).done;)t.push(r.value);return t}function ht(e,t,r){for(var n=0,a=r.length;n<a;){if(e(t,r[n]))return!0;n+=1}return!1}function Yt(e){var t=String(e).match(/^function (\w*)/);return t==null?"":t[1]}function Zt(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}var B=typeof Object.is=="function"?Object.is:Zt;function dt(e,t,r,n){var a=pt(e),u=pt(t);function o(c,i){return z(c,i,r.slice(),n.slice())}return!ht(function(c,i){return!ht(o,i,c)},u,a)}function z(e,t,r,n){if(B(e,t))return!0;var a=gt(e);if(a!==gt(t))return!1;if(typeof e["fantasy-land/equals"]=="function"||typeof t["fantasy-land/equals"]=="function")return typeof e["fantasy-land/equals"]=="function"&&e["fantasy-land/equals"](t)&&typeof t["fantasy-land/equals"]=="function"&&t["fantasy-land/equals"](e);if(typeof e.equals=="function"||typeof t.equals=="function")return typeof e.equals=="function"&&e.equals(t)&&typeof t.equals=="function"&&t.equals(e);switch(a){case"Arguments":case"Array":case"Object":if(typeof e.constructor=="function"&&Yt(e.constructor)==="Promise")return e===t;break;case"Boolean":case"Number":case"String":if(!(typeof e==typeof t&&B(e.valueOf(),t.valueOf())))return!1;break;case"Date":if(!B(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(!(e.source===t.source&&e.global===t.global&&e.ignoreCase===t.ignoreCase&&e.multiline===t.multiline&&e.sticky===t.sticky&&e.unicode===t.unicode))return!1;break}for(var u=r.length-1;u>=0;){if(r[u]===e)return n[u]===t;u-=1}switch(a){case"Map":return e.size!==t.size?!1:dt(e.entries(),t.entries(),r.concat([e]),n.concat([t]));case"Set":return e.size!==t.size?!1:dt(e.values(),t.values(),r.concat([e]),n.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var o=b(e);if(o.length!==b(t).length)return!1;var c=r.concat([e]),i=n.concat([t]);for(u=o.length-1;u>=0;){var p=o[u];if(!(T(p,t)&&z(t[p],e[p],c,i)))return!1;u-=1}return!0}var Jt=f(function(t,r){return z(t,r,[],[])});function Qt(e,t,r){var n,a;if(typeof e.indexOf=="function")switch(typeof t){case"number":if(t===0){for(n=1/t;r<e.length;){if(a=e[r],a===0&&1/a===n)return r;r+=1}return-1}else if(t!==t){for(;r<e.length;){if(a=e[r],typeof a=="number"&&a!==a)return r;r+=1}return-1}return e.indexOf(t,r);case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,r);case"object":if(t===null)return e.indexOf(t,r)}for(;r<e.length;){if(Jt(e[r],t))return r;r+=1}return-1}function te(e,t){return Qt(t,e,0)>=0}function X(e){var t=e.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+t.replace(/"/g,'\\"')+'"'}var C=function(t){return(t<10?"0":"")+t},ee=typeof Date.prototype.toISOString=="function"?function(t){return t.toISOString()}:function(t){return t.getUTCFullYear()+"-"+C(t.getUTCMonth()+1)+"-"+C(t.getUTCDate())+"T"+C(t.getUTCHours())+":"+C(t.getUTCMinutes())+":"+C(t.getUTCSeconds())+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};function re(e){return function(){return!e.apply(this,arguments)}}function ne(e,t){for(var r=0,n=t.length,a=[];r<n;)e(t[r])&&(a[a.length]=t[r]),r+=1;return a}function ae(e){return Object.prototype.toString.call(e)==="[object Object]"}var ue=(function(){function e(t,r){this.xf=r,this.f=t}return e.prototype["@@transducer/init"]=A.init,e.prototype["@@transducer/result"]=A.result,e.prototype["@@transducer/step"]=function(t,r){return this.f(r)?this.xf["@@transducer/step"](t,r):t},e})(),ie=f(function(t,r){return new ue(t,r)}),oe=f(W(["fantasy-land/filter","filter"],ie,function(e,t){return ae(t)?I(function(r,n){return e(t[n])&&(r[n]=t[n]),r},{},b(t)):ne(e,t)})),ce=f(function(t,r){return oe(re(t),r)});function yt(e,t){var r=function(o){var c=t.concat([e]);return te(o,c)?"<Circular>":yt(o,c)},n=function(u,o){return k(function(c){return X(c)+": "+r(u[c])},o.slice().sort())};switch(Object.prototype.toString.call(e)){case"[object Arguments]":return"(function() { return arguments; }("+k(r,e).join(", ")+"))";case"[object Array]":return"["+k(r,e).concat(n(e,ce(function(u){return/^\d+$/.test(u)},b(e)))).join(", ")+"]";case"[object Boolean]":return typeof e=="object"?"new Boolean("+r(e.valueOf())+")":e.toString();case"[object Date]":return"new Date("+(isNaN(e.valueOf())?r(NaN):X(ee(e)))+")";case"[object Null]":return"null";case"[object Number]":return typeof e=="object"?"new Number("+r(e.valueOf())+")":1/e===-1/0?"-0":e.toString(10);case"[object String]":return typeof e=="object"?"new String("+r(e.valueOf())+")":X(e);case"[object Undefined]":return"undefined";default:if(typeof e.toString=="function"){var a=e.toString();if(a!=="[object Object]")return a}return"{"+n(e,b(e)).join(", ")+"}"}}var se=h(function(t){return yt(t,[])}),le=st(-1),fe=f(function(t,r){return t>r}),ge=U(function(t,r,n){return q(Math.max(t.length,r.length,n.length),function(){return t.apply(this,arguments)?r.apply(this,arguments):n.apply(this,arguments)})}),pe=f(P("intersperse",function(t,r){for(var n=[],a=0,u=r.length;a<u;)a===u-1?n.push(r[a]):n.push(r[a],t),a+=1;return n})),vt=f(function(t,r){return q(t+1,function(){var n=arguments[t];if(n!=null&&qt(n[r]))return n[r].apply(n,Array.prototype.slice.call(arguments,0,t));throw new TypeError(se(n)+' does not have a method named "'+r+'"')})}),K=vt(1,"join"),he=f(function(t,r){var n={};return x(r.length,function(){var a=t.apply(this,arguments);return T(a,n)||(n[a]=r.apply(this,arguments)),n[a]})}),$=vt(1,"split"),N=`	
\v\f\r                　\u2028\u2029\uFEFF`,de="​",ye=typeof String.prototype.trim=="function",ve=h(!ye||N.trim()||!de.trim()?function(t){var r=new RegExp("^["+N+"]["+N+"]*"),n=new RegExp("["+N+"]["+N+"]*$");return t.replace(r,"").replace(n,"")}:function(t){return t.trim()});const me=he(Vt);pe(`
`),$(`
`),K(`
`);const Se=e=>L(K(" "),t=>e.measureText(t),Ht("width")),_e=(e,t,r)=>L($(`
`),M(L($(" "),M(ve))),zt(lt((a,u)=>L(le,ft(u),e,ge(fe(bt,t),()=>a.concat([[u]]),()=>Et(-1,ft(u),a)))(a),[[]])),M(K(" ")))(r).map((a,u)=>({text:a,lineNum:u+1})),Oe=e=>(t="")=>{let r;const n=[];let a=0;if(!t)return e;const u=t.toLowerCase(),o=new Set;for(r=0;r<e.length;r++)e[r].text.toLowerCase().indexOf(u)>=0&&(a++,r>0&&o.add(r-1),o.add(r),r<e.length-1&&o.add(r+1));const c=Array.from(o).sort((i,p)=>i-p);for(r=0;r<c.length;r++)n.push(e[c[r]]);return{searchText:t,results:n,total:a}},we=(e,t)=>r=>Math.max(e,Math.min(t,r)),Ae=({ctx:e,width:t=10,height:r=100,canvasWidth:n,canvasHeight:a,scrollOffset:u=0,updateCanvas:o,color:c="black"})=>{const i={x:0,y:0,width:t,height:r,dragging:!1,textHeight:0,canvasWidth:n,canvasHeight:a,scrollOffset:u},p=(g,j)=>g>=i.x&&g<=i.x+i.width&&j>=i.y&&j<=i.y+i.height;let y,O;const w=()=>{O=Math.min(-i.textHeight+i.canvasHeight-100,0),y=we(O,0)};return w(),{draw(){const g=i.scrollOffset/O;i.y=(i.canvasHeight-i.height)*g,i.x=n-i.width,e.fillStyle=c,e.fillRect(i.x,i.y,i.width,i.height)},setTextHeight(g){i.textHeight=g,w()},setCanvasHeight(g){i.canvasHeight=g,w()},setCanvasWidth(g){i.canvasWidth=g,w()},resizeCanvas(g,j){i.canvasWidth=g,i.canvasHeight=j},applyScrollDelta(g){this.setScrollOffset(y(i.scrollOffset-g))},setScrollOffset(g){i.scrollOffset=g,o()},handleMouseDown(g){p(g.x,g.y)&&(i.dragging=!0)},handleMouseUp(g){i.dragging&&(i.dragging=!1)},handleMouseMove(g){if(i.dragging&&g.buttons){const j=i.canvasHeight-i.height,je=(i.textHeight-i.canvasHeight)/j;this.applyScrollDelta(g.movementY*je)}},getScrollOffset:()=>i.scrollOffset,getX:()=>i.x,getY:()=>i.y,getWidth:()=>i.width,getHeight:()=>i.height,getTextHeight:()=>i.textHeight,getCanvasHeight:()=>i.canvasHeight}};let s,m,S,G,R="",V,mt,E=1.1,Y,_=15,St,H=[],Z=[],d;const _t=60,J=10,Ot=e=>{if(R=e,R&&V){const{results:t}=V(R);H=t}else H=Z;d&&(d.setTextHeight(_*E*H.length),d.setScrollOffset(0))},be=(e,t,r,n,a)=>{if(!a){s.fillText(e,t,r,n);return}const u=e.toLowerCase(),o=a.toLowerCase();let c=t,i=0,p=u.indexOf(o);for(;p!==-1;){if(p>i){const w=e.substring(i,p);s.fillText(w,c,r),c+=s.measureText(w).width}const y=e.substring(p,p+o.length),O=s.measureText(y).width;s.fillStyle="#ffeb3b",s.fillRect(c,r-2,O,_*1.1),s.fillStyle=Y,s.fillText(y,c,r),c+=O,i=p+o.length,p=u.indexOf(o,i)}if(i<e.length){const y=e.substring(i);s.fillText(y,c,r)}},Q=()=>{if(!s)return;s.clearRect(0,0,m,S);let e,t,r;const n=d.getScrollOffset(),a=Math.floor(-n/_/E),u=Math.ceil(S/(E*_))+a,o=m-J-5,c=m-_t-J-5;for(t=a;t<=u&&(e=H[t],e!==void 0);t++){if(r=t*E*_+n,r>=-(E*_)&&r<S){const i=typeof e=="string"?e:e.text;be(i,0,r,c,R),e.lineNum!==void 0&&(s.save(),s.textAlign="right",s.fillStyle="#888",s.fillText(e.lineNum.toString(),o,r),s.restore())}if(r>S)break}d.draw()},wt=e=>{const{font:t,baseline:r,align:n,strokeStyle:a}=e;E=e.lineHeight,_=e.size,Y=e.fillStyle,s&&(s.font=t,s.textBaseline=r,s.textAlign=n,s.fillStyle=Y,s.strokeStyle=a)},At=e=>{s&&(s.save(),s.clearRect(0,0,m,S),s.font="15px Helvetica",s.textAlign="center",s.textBaseline="middle",s.fillStyle="black",s.fillText(e,m/2,S/2),s.restore())},Ee=()=>{Z=_e(mt,m-_t-J-5,St),V=me(Oe(Z))};self.onmessage=e=>{switch(e.data.type){case v.INIT:{const{route:t,canvas:r}=e.data;m=e.data.width,S=e.data.height,s=r.getContext("2d"),mt=Se(s),d=Ae({ctx:s,canvasWidth:m,canvasHeight:S,updateCanvas:Q}),wt(e.data),G=e.data.ratio,s.setTransform(G,0,0,G,0,0),At(`Loading ${t}`),fetch(t).then(n=>n.text()).then(n=>{console.log(n),At(`Content Loaded (${n.length}), parsing...`),St=n,requestAnimationFrame(()=>{Ee(),Ot(""),d.setScrollOffset(0)})}).catch(n=>{console.log(n)});break}case v.KILL:break;case v.SCROLL:{const{scrollDelta:t}=e.data;d.applyScrollDelta(t);break}case v.UPDATE:{wt(e.data),Q();break}case v.SEARCH:{Ot(e.data.searchText),Q();break}case v.MOUSE_DOWN:d.handleMouseDown(e.data);break;case v.MOUSE_UP:d.handleMouseUp(e.data);break;case v.MOUSE_MOVE:d&&d.handleMouseMove(e.data);break;default:console.log("?",e)}}})();
