(function(){"use strict";const y={INIT:"INIT",KILL:"KILL",SCROLL:"SCROLL",UPDATE:"UPDATE",SEARCH:"SEARCH",MOUSE_DOWN:"MOUSE_DOWN",MOUSE_UP:"MOUSE_UP",MOUSE_MOVE:"MOUSE_MOVE"};var we={"@@functional/placeholder":!0};function s(t){return t!=null&&typeof t=="object"&&t["@@functional/placeholder"]===!0}function g(t){return function e(r){return arguments.length===0||s(r)?e:t.apply(this,arguments)}}function l(t){return function e(r,n){switch(arguments.length){case 0:return e;case 1:return s(r)?e:g(function(u){return t(r,u)});default:return s(r)&&s(n)?e:s(r)?g(function(u){return t(u,n)}):s(n)?g(function(u){return t(r,u)}):t(r,n)}}}function J(t,e){t=t||[],e=e||[];var r,n=t.length,u=e.length,a=[];for(r=0;r<n;)a[a.length]=t[r],r+=1;for(r=0;r<u;)a[a.length]=e[r],r+=1;return a}function A(t,e){switch(t){case 0:return function(){return e.apply(this,arguments)};case 1:return function(r){return e.apply(this,arguments)};case 2:return function(r,n){return e.apply(this,arguments)};case 3:return function(r,n,u){return e.apply(this,arguments)};case 4:return function(r,n,u,a){return e.apply(this,arguments)};case 5:return function(r,n,u,a,o){return e.apply(this,arguments)};case 6:return function(r,n,u,a,o,c){return e.apply(this,arguments)};case 7:return function(r,n,u,a,o,c,i){return e.apply(this,arguments)};case 8:return function(r,n,u,a,o,c,i,v){return e.apply(this,arguments)};case 9:return function(r,n,u,a,o,c,i,v,T){return e.apply(this,arguments)};case 10:return function(r,n,u,a,o,c,i,v,T,L){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function Q(t,e,r){return function(){for(var n=[],u=0,a=t,o=0;o<e.length||u<arguments.length;){var c;o<e.length&&(!s(e[o])||u>=arguments.length)?c=e[o]:(c=arguments[u],u+=1),n[o]=c,s(c)||(a-=1),o+=1}return a<=0?r.apply(this,n):A(a,Q(t,n,r))}}var N=l(function(e,r){return e===1?g(r):A(e,Q(e,[],r))});function M(t){return function e(r,n,u){switch(arguments.length){case 0:return e;case 1:return s(r)?e:l(function(a,o){return t(r,a,o)});case 2:return s(r)&&s(n)?e:s(r)?l(function(a,o){return t(a,n,o)}):s(n)?l(function(a,o){return t(r,a,o)}):g(function(a){return t(r,n,a)});default:return s(r)&&s(n)&&s(u)?e:s(r)&&s(n)?l(function(a,o){return t(a,o,u)}):s(r)&&s(u)?l(function(a,o){return t(a,n,o)}):s(n)&&s(u)?l(function(a,o){return t(r,a,o)}):s(r)?g(function(a){return t(a,n,u)}):s(n)?g(function(a){return t(r,a,u)}):s(u)?g(function(a){return t(r,n,a)}):t(r,n,u)}}}var Ae=M(function(e,r,n){var u=n.length;if(e>=u||e<-u)return n;var a=(u+e)%u,o=J(n);return o[a]=r(n[a]),o}),q=Array.isArray||function(e){return e!=null&&e.length>=0&&Object.prototype.toString.call(e)==="[object Array]"};function je(t){return t!=null&&typeof t["@@transducer/step"]=="function"}function F(t,e,r){return function(){if(arguments.length===0)return r();var n=arguments[arguments.length-1];if(!q(n)){for(var u=0;u<t.length;){if(typeof n[t[u]]=="function")return n[t[u]].apply(n,Array.prototype.slice.call(arguments,0,-1));u+=1}if(je(n)){var a=e.apply(null,Array.prototype.slice.call(arguments,0,-1));return a(n)}}return r.apply(this,arguments)}}var m={init:function(){return this.xf["@@transducer/init"]()},result:function(t){return this.xf["@@transducer/result"](t)}};function C(t,e){for(var r=0,n=e.length,u=Array(n);r<n;)u[r]=t(e[r]),r+=1;return u}function ee(t){return Object.prototype.toString.call(t)==="[object String]"}var D=g(function(e){return q(e)?!0:!e||typeof e!="object"||ee(e)?!1:e.length===0?!0:e.length>0?e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1):!1}),Ee=(function(){function t(e){this.f=e}return t.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},t.prototype["@@transducer/result"]=function(e){return e},t.prototype["@@transducer/step"]=function(e,r){return this.f(e,r)},t})();function be(t){return new Ee(t)}var Ie=l(function(e,r){return A(e.length,function(){return e.apply(r,arguments)})});function xe(t,e,r){for(var n=0,u=r.length;n<u;){if(e=t["@@transducer/step"](e,r[n]),e&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}n+=1}return t["@@transducer/result"](e)}function te(t,e,r){for(var n=r.next();!n.done;){if(e=t["@@transducer/step"](e,n.value),e&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}n=r.next()}return t["@@transducer/result"](e)}function re(t,e,r,n){return t["@@transducer/result"](r[n](Ie(t["@@transducer/step"],t),e))}var ne=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function j(t,e,r){if(typeof t=="function"&&(t=be(t)),D(r))return xe(t,e,r);if(typeof r["fantasy-land/reduce"]=="function")return re(t,e,r,"fantasy-land/reduce");if(r[ne]!=null)return te(t,e,r[ne]());if(typeof r.next=="function")return te(t,e,r);if(typeof r.reduce=="function")return re(t,e,r,"reduce");throw new TypeError("reduce: list must be array or iterable")}var Me=(function(){function t(e,r){this.xf=r,this.f=e}return t.prototype["@@transducer/init"]=m.init,t.prototype["@@transducer/result"]=m.result,t.prototype["@@transducer/step"]=function(e,r){return this.xf["@@transducer/step"](e,this.f(r))},t})(),Ce=l(function(e,r){return new Me(e,r)});function E(t,e){return Object.prototype.hasOwnProperty.call(e,t)}var ue=Object.prototype.toString,Ue=(function(){return ue.call(arguments)==="[object Arguments]"?function(e){return ue.call(e)==="[object Arguments]"}:function(e){return E("callee",e)}})(),ke=!{toString:null}.propertyIsEnumerable("toString"),ae=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],ie=(function(){return arguments.propertyIsEnumerable("length")})(),Te=function(e,r){for(var n=0;n<e.length;){if(e[n]===r)return!0;n+=1}return!1},S=g(typeof Object.keys=="function"&&!ie?function(e){return Object(e)!==e?[]:Object.keys(e)}:function(e){if(Object(e)!==e)return[];var r,n,u=[],a=ie&&Ue(e);for(r in e)E(r,e)&&(!a||r!=="length")&&(u[u.length]=r);if(ke)for(n=ae.length-1;n>=0;)r=ae[n],E(r,e)&&!Te(u,r)&&(u[u.length]=r),n-=1;return u}),b=l(F(["fantasy-land/map","map"],Ce,function(e,r){switch(Object.prototype.toString.call(r)){case"[object Function]":return N(r.length,function(){return e.call(this,r.apply(this,arguments))});case"[object Object]":return j(function(n,u){return n[u]=e(r[u]),n},{},S(r));default:return C(e,r)}})),Le=Number.isInteger||function(e){return e<<0===e},oe=l(function(e,r){var n=e<0?r.length+e:e;return ee(r)?r.charAt(n):r[n]}),Re=l(function(e,r){if(r!=null)return Le(e)?oe(e,r):r[e]}),ce=M(j),se=l(function(e,r){return J(r,[e])});function He(t){var e=Object.prototype.toString.call(t);return e==="[object Function]"||e==="[object AsyncFunction]"||e==="[object GeneratorFunction]"||e==="[object AsyncGeneratorFunction]"}function Ne(t){return function(r){for(var n,u,a,o=[],c=0,i=r.length;c<i;){if(D(r[c]))for(n=r[c],a=0,u=n.length;a<u;)o[o.length]=n[a],a+=1;else o[o.length]=r[c];c+=1}return o}}function qe(t){return{"@@transducer/value":t,"@@transducer/reduced":!0}}var Fe=function(t){return{"@@transducer/init":m.init,"@@transducer/result":function(e){return t["@@transducer/result"](e)},"@@transducer/step":function(e,r){var n=t["@@transducer/step"](e,r);return n["@@transducer/reduced"]?qe(n):n}}},De=function(e){var r=Fe(e);return{"@@transducer/init":m.init,"@@transducer/result":function(n){return r["@@transducer/result"](n)},"@@transducer/step":function(n,u){return D(u)?j(r,n,u):j(r,n,[u])}}},Pe=l(function(e,r){return b(e,De(r))}),Be=l(F(["fantasy-land/chain","chain"],Pe,function(e,r){return typeof r=="function"?function(n){return e(r(n))(n)}:Ne()(b(e,r))})),le=g(function(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)});function We(t,e){return function(){return e.call(this,t.apply(this,arguments))}}function P(t,e){return function(){var r=arguments.length;if(r===0)return e();var n=arguments[r-1];return q(n)||typeof n[t]!="function"?e.apply(this,arguments):n[t].apply(n,Array.prototype.slice.call(arguments,0,r-1))}}var ze=M(P("slice",function(e,r,n){return Array.prototype.slice.call(n,e,r)})),Xe=g(P("tail",ze(1,1/0)));function U(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return A(arguments[0].length,ce(We,arguments[0],Xe(arguments)))}function Ke(t){return t}var $e=g(Ke);function fe(t){for(var e=[],r;!(r=t.next()).done;)e.push(r.value);return e}function pe(t,e,r){for(var n=0,u=r.length;n<u;){if(t(e,r[n]))return!0;n+=1}return!1}function Ge(t){var e=String(t).match(/^function (\w*)/);return e==null?"":e[1]}function Ve(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}var B=typeof Object.is=="function"?Object.is:Ve;function ge(t,e,r,n){var u=fe(t),a=fe(e);function o(c,i){return W(c,i,r.slice(),n.slice())}return!pe(function(c,i){return!pe(o,i,c)},a,u)}function W(t,e,r,n){if(B(t,e))return!0;var u=le(t);if(u!==le(e))return!1;if(typeof t["fantasy-land/equals"]=="function"||typeof e["fantasy-land/equals"]=="function")return typeof t["fantasy-land/equals"]=="function"&&t["fantasy-land/equals"](e)&&typeof e["fantasy-land/equals"]=="function"&&e["fantasy-land/equals"](t);if(typeof t.equals=="function"||typeof e.equals=="function")return typeof t.equals=="function"&&t.equals(e)&&typeof e.equals=="function"&&e.equals(t);switch(u){case"Arguments":case"Array":case"Object":if(typeof t.constructor=="function"&&Ge(t.constructor)==="Promise")return t===e;break;case"Boolean":case"Number":case"String":if(!(typeof t==typeof e&&B(t.valueOf(),e.valueOf())))return!1;break;case"Date":if(!B(t.valueOf(),e.valueOf()))return!1;break;case"Error":return t.name===e.name&&t.message===e.message;case"RegExp":if(!(t.source===e.source&&t.global===e.global&&t.ignoreCase===e.ignoreCase&&t.multiline===e.multiline&&t.sticky===e.sticky&&t.unicode===e.unicode))return!1;break}for(var a=r.length-1;a>=0;){if(r[a]===t)return n[a]===e;a-=1}switch(u){case"Map":return t.size!==e.size?!1:ge(t.entries(),e.entries(),r.concat([t]),n.concat([e]));case"Set":return t.size!==e.size?!1:ge(t.values(),e.values(),r.concat([t]),n.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var o=S(t);if(o.length!==S(e).length)return!1;var c=r.concat([t]),i=n.concat([e]);for(a=o.length-1;a>=0;){var v=o[a];if(!(E(v,e)&&W(e[v],t[v],c,i)))return!1;a-=1}return!0}var Ye=l(function(e,r){return W(e,r,[],[])});function Ze(t,e,r){var n,u;if(typeof t.indexOf=="function")switch(typeof e){case"number":if(e===0){for(n=1/e;r<t.length;){if(u=t[r],u===0&&1/u===n)return r;r+=1}return-1}else if(e!==e){for(;r<t.length;){if(u=t[r],typeof u=="number"&&u!==u)return r;r+=1}return-1}return t.indexOf(e,r);case"string":case"boolean":case"function":case"undefined":return t.indexOf(e,r);case"object":if(e===null)return t.indexOf(e,r)}for(;r<t.length;){if(Ye(t[r],e))return r;r+=1}return-1}function Je(t,e){return Ze(e,t,0)>=0}function z(t){var e=t.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+e.replace(/"/g,'\\"')+'"'}var I=function(e){return(e<10?"0":"")+e},Qe=typeof Date.prototype.toISOString=="function"?function(e){return e.toISOString()}:function(e){return e.getUTCFullYear()+"-"+I(e.getUTCMonth()+1)+"-"+I(e.getUTCDate())+"T"+I(e.getUTCHours())+":"+I(e.getUTCMinutes())+":"+I(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};function et(t){return function(){return!t.apply(this,arguments)}}function tt(t,e){for(var r=0,n=e.length,u=[];r<n;)t(e[r])&&(u[u.length]=e[r]),r+=1;return u}function rt(t){return Object.prototype.toString.call(t)==="[object Object]"}var nt=(function(){function t(e,r){this.xf=r,this.f=e}return t.prototype["@@transducer/init"]=m.init,t.prototype["@@transducer/result"]=m.result,t.prototype["@@transducer/step"]=function(e,r){return this.f(r)?this.xf["@@transducer/step"](e,r):e},t})(),ut=l(function(e,r){return new nt(e,r)}),at=l(F(["fantasy-land/filter","filter"],ut,function(t,e){return rt(e)?j(function(r,n){return t(e[n])&&(r[n]=e[n]),r},{},S(e)):tt(t,e)})),it=l(function(e,r){return at(et(e),r)});function he(t,e){var r=function(o){var c=e.concat([t]);return Je(o,c)?"<Circular>":he(o,c)},n=function(a,o){return C(function(c){return z(c)+": "+r(a[c])},o.slice().sort())};switch(Object.prototype.toString.call(t)){case"[object Arguments]":return"(function() { return arguments; }("+C(r,t).join(", ")+"))";case"[object Array]":return"["+C(r,t).concat(n(t,it(function(a){return/^\d+$/.test(a)},S(t)))).join(", ")+"]";case"[object Boolean]":return typeof t=="object"?"new Boolean("+r(t.valueOf())+")":t.toString();case"[object Date]":return"new Date("+(isNaN(t.valueOf())?r(NaN):z(Qe(t)))+")";case"[object Null]":return"null";case"[object Number]":return typeof t=="object"?"new Number("+r(t.valueOf())+")":1/t===-1/0?"-0":t.toString(10);case"[object String]":return typeof t=="object"?"new String("+r(t.valueOf())+")":z(t);case"[object Undefined]":return"undefined";default:if(typeof t.toString=="function"){var u=t.toString();if(u!=="[object Object]")return u}return"{"+n(t,S(t)).join(", ")+"}"}}var ot=g(function(e){return he(e,[])}),ct=oe(-1),st=l(function(e,r){return e>r}),lt=M(function(e,r,n){return N(Math.max(e.length,r.length,n.length),function(){return e.apply(this,arguments)?r.apply(this,arguments):n.apply(this,arguments)})}),ft=l(P("intersperse",function(e,r){for(var n=[],u=0,a=r.length;u<a;)u===a-1?n.push(r[u]):n.push(r[u],e),u+=1;return n})),ye=l(function(e,r){return N(e+1,function(){var n=arguments[e];if(n!=null&&He(n[r]))return n[r].apply(n,Array.prototype.slice.call(arguments,0,e));throw new TypeError(ot(n)+' does not have a method named "'+r+'"')})}),X=ye(1,"join"),pt=l(function(e,r){var n={};return A(r.length,function(){var u=e.apply(this,arguments);return E(u,n)||(n[u]=r.apply(this,arguments)),n[u]})}),K=ye(1,"split"),x=`	
\v\f\r                　\u2028\u2029\uFEFF`,gt="​",ht=typeof String.prototype.trim=="function",yt=g(!ht||x.trim()||!gt.trim()?function(e){var r=new RegExp("^["+x+"]["+x+"]*"),n=new RegExp("["+x+"]["+x+"]*$");return e.replace(r,"").replace(n,"")}:function(e){return e.trim()});const dt=pt($e),vt=ft(`
`);K(`
`),X(`
`);const mt=t=>U(X(" "),e=>t.measureText(e),Re("width")),St=(t,e,r)=>U(K(`
`),b(U(K(" "),b(yt))),Be(ce((n,u)=>U(ct,se(u),t,lt(st(we,e),()=>n.concat([[u]]),()=>Ae(-1,se(u),n)))(n),[[]])),b(X(" ")))(r),_t=t=>(e="")=>{let r;const n=[];let u=0;if(!e)return t;const a=e.toLowerCase();for(r=0;r<t.length;r++)t[r].toLowerCase().indexOf(a)>=0&&(u++,n.push(t[r]));return{searchText:e,results:vt(n),total:u}},Ot=(t,e)=>r=>Math.max(t,Math.min(e,r)),wt=({ctx:t,width:e=10,height:r=100,canvasWidth:n,canvasHeight:u,scrollOffset:a=0,updateCanvas:o,color:c="black"})=>{const i={x:0,y:0,width:e,height:r,dragging:!1,textHeight:0,canvasWidth:n,canvasHeight:u,scrollOffset:a},v=(f,H)=>f>=i.x&&f<=i.x+i.width&&H>=i.y&&H<=i.y+i.height;let T,L;const R=()=>{L=Math.min(-i.textHeight+i.canvasHeight-100,0),T=Ot(L,0)};return R(),{draw(){const f=i.scrollOffset/L;i.y=(i.canvasHeight-i.height)*f,i.x=n-i.width,t.fillStyle=c,t.fillRect(i.x,i.y,i.width,i.height)},setTextHeight(f){i.textHeight=f,R()},setCanvasHeight(f){i.canvasHeight=f,R()},setCanvasWidth(f){i.canvasWidth=f,R()},resizeCanvas(f,H){i.canvasWidth=f,i.canvasHeight=H},applyScrollDelta(f){this.setScrollOffset(T(i.scrollOffset-f))},setScrollOffset(f){i.scrollOffset=f,o()},handleMouseDown(f){v(f.x,f.y)&&(i.dragging=!0)},handleMouseUp(f){i.dragging&&(i.dragging=!1)},handleMouseMove(f){i.dragging&&f.buttons&&this.applyScrollDelta(f.movementY)},getScrollOffset:()=>i.scrollOffset,getX:()=>i.x,getY:()=>i.y,getWidth:()=>i.width,getHeight:()=>i.height,getTextHeight:()=>i.textHeight,getCanvasHeight:()=>i.canvasHeight}};let p,_,d,$,G="",V,de,O=1.1,ve,w=15,me,k=[],Y=[],h;const Se=t=>{if(G=t,G&&V){const{results:e}=V(G);k=e}else k=Y;h&&(h.setTextHeight(w*O*k.length),h.setScrollOffset(0))},Z=()=>{if(!p)return;p.clearRect(0,0,_,d);let t,e,r;const n=h.getScrollOffset(),u=Math.floor(-n/w/O),a=Math.ceil(d/(O*w))+u;for(e=u;e<=a&&(t=k[e],!(t===void 0||(r=e*O*w+n,r>=-(O*w)&&r<d&&p.fillText(t,0,r),r>d)));e++);h.draw()},_e=t=>{const{font:e,baseline:r,align:n,strokeStyle:u}=t;O=t.lineHeight,w=t.size,ve=t.fillStyle,p&&(p.font=e,p.textBaseline=r,p.textAlign=n,p.fillStyle=ve,p.strokeStyle=u)},Oe=t=>{p&&(p.save(),p.clearRect(0,0,_,d),p.font="15px Helvetica",p.textAlign="center",p.textBaseline="middle",p.fillStyle="black",p.fillText(t,_/2,d/2),p.restore())},At=()=>{Y=St(de,_-5,me),V=dt(_t(Y))};self.onmessage=t=>{switch(t.data.type){case y.INIT:{const{route:e,canvas:r}=t.data;_=t.data.width,d=t.data.height,p=r.getContext("2d"),de=mt(p),h=wt({ctx:p,canvasWidth:_,canvasHeight:d,updateCanvas:Z}),_e(t.data),$=t.data.ratio,p.setTransform($,0,0,$,0,0),Oe(`Loading ${e}`),fetch(e).then(n=>n.text()).then(n=>{console.log(n),Oe(`Content Loaded (${n.length}), parsing...`),me=n,requestAnimationFrame(()=>{At(),Se(""),h.setScrollOffset(0)})}).catch(n=>{console.log(n)});break}case y.KILL:break;case y.SCROLL:{const{scrollDelta:e}=t.data;h.applyScrollDelta(e);break}case y.UPDATE:{_e(t.data),Z();break}case y.SEARCH:{Se(t.data.searchText),Z();break}case y.MOUSE_DOWN:h.handleMouseDown(t.data);break;case y.MOUSE_UP:h.handleMouseUp(t.data);break;case y.MOUSE_MOVE:h&&h.handleMouseMove(t.data);break;default:console.log("?",t)}}})();
